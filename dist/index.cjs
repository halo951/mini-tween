"use strict";const interpolation_linear=require("./interpolation/linear.cjs"),easing_linear=require("./easing/linear.cjs"),now=()=>performance.now();var w=Object.defineProperty,u=(_,t,e)=>t in _?w(_,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):_[t]=e,i$1=(_,t,e)=>(u(_,typeof t!="symbol"?t+"":t,e),e);class Group{constructor(...t){i$1(this,"_tweens",{}),i$1(this,"_tweensAddedDuringUpdate",{}),this.add(...t)}getAll(){return Object.keys(this._tweens).map(t=>this._tweens[t])}removeAll(){this._tweens={}}add(...t){for(const e of t)e._group?.remove(e),e._group=this,this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e}remove(...t){for(const e of t)e._group=void 0,delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]}allStopped(){return this.getAll().every(t=>!t.isPlaying())}update(t=now(),e=!0){let a=Object.keys(this._tweens);if(a.length!==0)for(;a.length>0;){this._tweensAddedDuringUpdate={};for(let h=0;h<a.length;h++){const o=this._tweens[a[h]],r=!e;o&&o.update(t,r)===!1&&!e&&this.remove(o)}a=Object.keys(this._tweensAddedDuringUpdate)}}}var x=Object.defineProperty,d=(_,t,e)=>t in _?x(_,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):_[t]=e,s=(_,t,e)=>(d(_,typeof t!="symbol"?t+"":t,e),e);const n=class C{static nextId(){return C._nextId++}};s(n,"_nextId",0);let Sequence=n;var T=Object.defineProperty,k=(_,t,e)=>t in _?T(_,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):_[t]=e,i=(_,t,e)=>(k(_,typeof t!="symbol"?t+"":t,e),e);const mainGroup=new Group,m=class P{constructor(t,e=mainGroup){i(this,"_isPaused",!1),i(this,"_pauseStart",0),i(this,"_valuesStart",{}),i(this,"_valuesEnd",{}),i(this,"_valuesStartRepeat",{}),i(this,"_duration",1e3),i(this,"_isDynamic",!1),i(this,"_initialRepeat",0),i(this,"_repeat",0),i(this,"_repeatDelayTime"),i(this,"_yoyo",!1),i(this,"_isPlaying",!1),i(this,"_reversed",!1),i(this,"_delayTime",0),i(this,"_startTime",0),i(this,"_easingFunction",easing_linear.Linear.None),i(this,"_interpolationFunction",interpolation_linear.Linear),i(this,"_chainedTweens",[]),i(this,"_onStartCallback"),i(this,"_onStartCallbackFired",!1),i(this,"_onEveryStartCallback"),i(this,"_onEveryStartCallbackFired",!1),i(this,"_onUpdateCallback"),i(this,"_onRepeatCallback"),i(this,"_onCompleteCallback"),i(this,"_onStopCallback"),i(this,"_id",Sequence.nextId()),i(this,"_isChainStopped",!1),i(this,"_propertiesAreSetUp",!1),i(this,"_object"),i(this,"_group"),i(this,"_goToEnd",!1),this._object=t,this._group=e,this._group.add(this)}getId(){return this._id}isPlaying(){return this._isPlaying}isPaused(){return this._isPaused}getDuration(){return this._duration}to(t,e=1e3){if(this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=e<0?0:e,this}duration(t=1e3){return this._duration=t<0?0:t,this}dynamic(t=!1){return this._isDynamic=t,this}start(t=now(),e=!1){if(this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(const a in this._valuesStartRepeat)this._swapEndStartRepeatValues(a),this._valuesStart[a]=this._valuesStartRepeat[a]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||e){if(this._propertiesAreSetUp=!0,!this._isDynamic){const a={};for(const h in this._valuesEnd)a[h]=this._valuesEnd[h];this._valuesEnd=a}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,e)}return this}startFromCurrentValues(t){return this.start(t,!0)}_setupProperties(t,e,a,h,o){for(const r in a){const l=t[r],c=Array.isArray(l),p=c?"array":typeof l;let v=!c&&Array.isArray(a[r]);if(!(p==="undefined"||p==="function")){if(v){const y=a[r];if(y.length===0)continue;const S=[l];for(let b=0,g=y.length;b<g;b+=1){const f=this._handleRelativeValue(l,y[b]);if(isNaN(f)){v=!1,console.warn("Found invalid interpolation list. Skipping.");break}S.push(f)}v&&(a[r]=S)}if((p==="object"||c)&&l&&!v){e[r]=c?[]:{};const y=l;for(const b in y)e[r][b]=y[b];h[r]=c?[]:{};let S=a[r];if(!this._isDynamic){const b={};for(const g in S)b[g]=S[g];a[r]=S=b}this._setupProperties(y,e[r],S,h[r],o)}else(typeof e[r]>"u"||o)&&(e[r]=l),c||(e[r]*=1),v?h[r]=a[r].slice().reverse():h[r]=e[r]||0}}}stop(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this}end(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this}pause(t=now()){return this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this)}resume(t=now()){return!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this)}stopChainedTweens(){for(let t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this}group(t){return t?(t.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)}remove(){return this._group?.remove(this),this}delay(t=0){return this._delayTime=t,this}repeat(t=0){return this._initialRepeat=t,this._repeat=t,this}repeatDelay(t){return this._repeatDelayTime=t,this}yoyo(t=!1){return this._yoyo=t,this}easing(t=easing_linear.Linear.None){return this._easingFunction=t,this}interpolation(t=interpolation_linear.Linear){return this._interpolationFunction=t,this}chain(...t){return this._chainedTweens=t,this}onStart(t){return this._onStartCallback=t,this}onEveryStart(t){return this._onEveryStartCallback=t,this}onUpdate(t){return this._onUpdateCallback=t,this}onRepeat(t){return this._onRepeatCallback=t,this}onComplete(t){return this._onCompleteCallback=t,this}onStop(t){return this._onStopCallback=t,this}update(t=now(),e=P.autoStartOnUpdate){if(this._isPaused)return!0;let a;if(!this._goToEnd&&!this._isPlaying)if(e)this.start(t,!0);else return!1;if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);const h=t-this._startTime,o=this._duration+(this._repeatDelayTime??this._delayTime),r=this._duration+this._repeat*o,l=(()=>{if(this._duration===0||h>r)return 1;const p=Math.trunc(h/o),v=h-p*o,y=Math.min(v/this._duration,1);return y===0&&h===this._duration?1:y})(),c=this._easingFunction(l);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,c),this._onUpdateCallback&&this._onUpdateCallback(this._object,l),this._duration===0||h>=this._duration)if(this._repeat>0){const p=Math.min(Math.trunc((h-this._duration)/o)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=p);for(a in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[a]=="string"&&(this._valuesStartRepeat[a]=this._valuesStartRepeat[a]+parseFloat(this._valuesEnd[a])),this._yoyo&&this._swapEndStartRepeatValues(a),this._valuesStart[a]=this._valuesStartRepeat[a];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=o*p,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(let p=0,v=this._chainedTweens.length;p<v;p++)this._chainedTweens[p].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0}_updateProperties(t,e,a,h){for(const o in a){if(e[o]===void 0)continue;const r=e[o]||0;let l=a[o];const c=Array.isArray(t[o]),p=Array.isArray(l);!c&&p?t[o]=this._interpolationFunction(l,h):typeof l=="object"&&l?this._updateProperties(t[o],r,l,h):(l=this._handleRelativeValue(r,l),typeof l=="number"&&(t[o]=r+(l-r)*h))}}_handleRelativeValue(t,e){return typeof e!="string"?e:e.charAt(0)==="+"||e.charAt(0)==="-"?t+parseFloat(e):parseFloat(e)}_swapEndStartRepeatValues(t){const e=this._valuesStartRepeat[t],a=this._valuesEnd[t];typeof a=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(a):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=e}};i(m,"autoStartOnUpdate",!1);let Tween=m;exports.Group=Group,exports.Sequence=Sequence,exports.Tween=Tween,exports.mainGroup=mainGroup;
